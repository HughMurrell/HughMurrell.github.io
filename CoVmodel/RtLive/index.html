<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Flot Examples: Interactivity</title>
	<link href="examples.css" rel="stylesheet" type="text/css">
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" ></script>
	<script language="javascript" type="text/javascript" src="source/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="lib/jquery.event.drag.js"></script>
    <script language="javascript" type="text/javascript" src="lib/jquery.mousewheel.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.canvaswrapper.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.colorhelpers.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.saturated.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.browser.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.drawSeries.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.uiConstants.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.navigate.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.touchNavigate.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.hover.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.touch.js"></script>
	<script language="javascript" type="text/javascript" src="source/jquery.flot.selection.js"></script>
    <script language="javascript" type="text/javascript" src="source/jquery.flot.image.js"></script>
    
	<script type="text/javascript">
        
        function display_plots(country) {
            image_file_name = "plots/Rt_"+country+".png";
            show_image(image_file_name,"#placeholder2");
            image_file_name = "plots/Nc_"+country+".png";
            show_image(image_file_name,"#placeholder3");
        }
        
        function populateCountries(countryElementId, names){
            // given the id of the <select> tag as function argument, it inserts <option> tags
            var countryElement = document.getElementById(countryElementId);
            countryElement.length=0;
            // countryElement.options[0] = new Option('Select Country','-1');
            countryElement.selectedIndex = 0;
            for (var i=0; i<names.length; i++) {
                countryElement.options[countryElement.length] = new Option(names[i],names[i]);
            }
            country = names[0];
            console.log(country);
            display_plots(country);
            // Assigned all countries. Now assign event listener.

            countryElement.onchange = function(){
                ind = countryElement.selectedIndex;
                country = names[ind];
                console.log(country);
                display_plots(country);
            }
        }

        
        function show_image(file_name,place) {
            var data = [[[file_name, 0, 0, 50, 2]]];

            var options = {
                series: {
                    images: {
                        show: true
                    }
                },
                xaxis: {
                    tickLength: 0,
                    ticks: [],
                    autoScale: "none",
                    min: 0,
                    max: 50
                },
                yaxis: {
                    tickLength: 0,
                    ticks: [],
                    autoScale: "none",
                    min: 0,
                    max: 2
                }
            };
            

            $.plot.image.loadDataImages(data, options, function () {
                $.plot(place, data, options);
            });
        }

	$(function() {
      
      var adata = [];
      
      d3.csv("data/ranking_alpha.csv", function(data) {
             var i = 0;
             data.forEach((d) => {
                   var dObj = {country: d.country, value: d.mlrt, low: d.low, high: d.high, i: i++};
                   adata.push(dObj);
                   });
//             adata.sort(function(a,b) {
//                 return a[0]-b[0]
//             });
             console.log("data read inside d3.csv, length = "+adata.length);
             
      
        console.log("data read, length = "+adata.length);

		var vals = [],
			highs = [],
            lows = [],
            labs = [],
            names = []
        ;

      for (var i = 0; i < adata.length; i++) {
        vals.push([i, adata[i]['value']]);
        highs.push([i, adata[i]['high']]);
        lows.push([i, adata[i]['low']]);
        names.push(adata[i]['country']);
      }
      
      console.log("first name = "+names[0]);
      console.log("first value = "+vals[0]);
             
      populateCountries("country",names);
             
      
		var plot = $.plot("#placeholder", [
			{ data: vals, label: "mlRt"}
			// { data: highs, label: "high"},
            // { data: lows, label: "low"}
		], {
			series: {
				lines: {
					show: false
				},
				points: {
                    radius: 8,
					show: true
				}
			},
                          colors: ["rgba(0,0,255,0.3)"],
			grid: {
				hoverable: true,
				clickable: true,
                markings:[
                          {yaxis: { from: 0.0, to: 0.1 },color: "rgba(0,255,0,1.0)"},
                          {yaxis: { from: 0.1, to: 0.2 },color: "rgba(0,255,0,0.9)"},
                          {yaxis: { from: 0.2, to: 0.3 },color: "rgba(0,255,0,0.8)"},
                          {yaxis: { from: 0.3, to: 0.4 },color: "rgba(0,255,0,0.7)"},
                          {yaxis: { from: 0.4, to: 0.5 },color: "rgba(0,255,0,0.6)"},
                          {yaxis: { from: 0.5, to: 0.6 },color: "rgba(0,255,0,0.5)"},
                          {yaxis: { from: 0.6, to: 0.7 },color: "rgba(0,255,0,0.4)"},
                          {yaxis: { from: 0.7, to: 0.8 },color: "rgba(0,255,0,0.3)"},
                          {yaxis: { from: 0.8, to: 0.9 },color: "rgba(0,255,0,0.2)"},
                          {yaxis: { from: 0.9, to: 1.0 },color: "rgba(0,255,0,0.1)"},
                          {yaxis: { from: 1.0, to: 1.1 },color: "rgba(255,0,0,0.1)"},
                          {yaxis: { from: 1.1, to: 1.2 },color: "rgba(255,0,0,0.2)"},
                          {yaxis: { from: 1.2, to: 1.3 },color: "rgba(255,0,0,0.3)"},
                          {yaxis: { from: 1.3, to: 1.4 },color: "rgba(255,0,0,0.4)"},
                          {yaxis: { from: 1.4, to: 1.5 },color: "rgba(255,0,0,0.5)"},
                          {yaxis: { from: 1.5, to: 1.6 },color: "rgba(255,0,0,0.6)"},
                          {yaxis: { from: 1.6, to: 1.7 },color: "rgba(255,0,0,0.7)"},
                          {yaxis: { from: 1.7, to: 1.8 },color: "rgba(255,0,0,0.8)"},
                          {yaxis: { from: 1.8, to: 1.9 },color: "rgba(255,0,0,0.9)"},
                          {yaxis: { from: 1.9, to: 3.2 },color: "rgba(255,0,0,1.0)"}]
			},
			yaxis: {
                tickLength: 0,
                ticks: [0, 1, 2],
				min: -0.2,
				max: 3.2
			},
            xaxis: {
                tickLength: 0,
                tickColor: "#fff",
                ticks:labs
            },
			// zoom: {
			//	interactive: true
			// },
			pan: {
				interactive: true,
				enableTouch: true
			}
		});

		window.setInterval(function () {
			plot.setData([
                          { data: vals, label: "mlRt"}
                // { data: highs, label: "high"},
                // { data: lows, label: "low"}

			]);
		}, 2000);

		$("<div id='tooltip'></div>").css({
			position: "absolute",
			display: "none",
			border: "1px solid #fdd",
			padding: "2px",
			"background-color": "#fee",
			opacity: 0.80
		}).appendTo("body");

		$("#placeholder").bind("plothover", function (event, pos, item) {

			if (!pos.x || !pos.y) {
				return;
			}
/*
			if ($("#enablePosition:checked").length > 0) {
				var str = "(" + pos.x.toFixed(2) + ", " + pos.y.toFixed(2) + ")";
				$("#hoverdata").text(str);
			}
*/
//			if ($("#enableTooltip:checked").length > 0) {
				if (item) {
					var x = item.datapoint[0].toFixed(0),
						y = item.datapoint[1].toFixed(2);

					$("#tooltip").html(names[x])   // item.series.label + " of " + x + " = " + y)
						.css({top: item.pageY+5, left: item.pageX+5})
						.fadeIn(200);
				} else {
					$("#tooltip").stop().hide();
				}
//			}
		});

		$("#placeholder").bind("plothovercleanup", function (event, pos, item) {
				$("#tooltip").hide();
		});

		$("#placeholder").bind("plotclick", function (event, pos, item) {
			if (item) {
				// $("#clickdata").text(" - click point " + item.dataIndex + " in " + item.series.label);
				plot.highlight(item.series, item.datapoint);
                               var ind = item.datapoint[0];
                               console.log("country index = "+ind);
                var countryElement = document.getElementById('country');
                countryElement.selectedIndex = ind;
                display_plots(names[ind]);
                
			}
		});

		// Add the Flot version string to the footer

		// $("#footer").prepend("Flot " + $.plot.version + " &ndash; ");
             
             });  // end of d3.csv
      
	});

	</script>
</head>
<body>
	<div id="header">
		<h3>COVID-19, intervention rankings, using Rt estimates</h3>
	</div>

    

	<div id="content">

<!--
        <p><label><input id="enableTooltip" type="checkbox" checked="checked"></input>Enable tooltip</label></p>
-->

		<div class="demo-container" >
			<div id="placeholder" class="demo-placeholder"></div>
		</div>

<!--
		<p>One of the goals of Flot is to support user interactions. Try pointing and clicking on the points.</p>

		<p>
			<label><input id="enablePosition" type="checkbox" checked="checked"></input>Show mouse position</label>
			<span id="hoverdata"></span>
			<span id="clickdata"></span>
		</p>

		<p>A tooltip is easy to build with a bit of jQuery code and the data returned from the plot.</p>
 -->
<!--
<script type= "text/javascript" src = "countries.js"></script>
<script language="javascript">
      populateCountries("country");
</script>
-->

<div style='text-align:left;'>
     Country:   <select id="country" name ="country"></select>
 </div>


       <table style="width:100%">
       <tr>
         <td>
             <div class="demo-container" style="width:600px;height:400px;">
                 <div id="placeholder2" class="demo-placeholder"></div>
             </div>
         </td>
         <td>
             <div class="demo-container" style="width:600px;height:400px;">
                 <div id="placeholder3" class="demo-placeholder"></div>
             </div>
         </td>
       </tr>
       </table>

	</div>

	<div id="footer">
        CREDITS: created by: Hugh Murrell, with help from Ben Murrell, on a suggestion from Dan Murrell, based on a model by Kevin Systrom, using Flot by IOLA and Ole Laursen and using COVID-19 data from OWID.
	</div>

</body>
</html>
